% calc_mag1G_mmp.m% Function: used within batchprocess4G_mmp to read and convert%   mag data.  Written for mmp3 carrying APS 3-axis fluxgate magnetometer.%	Input: drop,mmpid,cruise,procdata, nscans%	Output: mag(1:nscans,1:3)% Matthew Alford 9/99 (modified 6/00 by Dave W)if (drop_flag==1 | drop_flag==2) & strcmp(mmpid,'mmp3')   mag=NaN*ones(nscans,3);   sv_file=[procdata filesep cruise filesep 'mag' filesep 'mag' int2str(drop) '.mat'];   if drop_flag==2 & exist(sv_file)==2      load(sv_file); % retrieve existing mag data   else      ch='mx';      % calibration algorithm works on all 3 axes in concert      algorithm=read_algorithm_mmp(ch,drop);      x_str=['mag=' algorithm '_mmp(drop);'];      eval(x_str)      save(sv_file, 'mag')      % For mag (and accel) data, no pressure is saved; instead, refer by      % scan number to monitor mmp3 orientation/motion at time of ACM measurement   end   clear sv_file algorithm x_strend