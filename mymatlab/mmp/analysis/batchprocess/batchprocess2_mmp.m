% batchprocess2_mmp% 	A revision of batchprocess1_mmp, written in July 1996 to% process data from the rebuilt mmp1 and mmp2 vehicles and the% new mmp3.  The first data will be mmp2262.% M.Gregg%		Calls m-scripts and functions to process a list of drops.%	Before executing: %		1. Make a list of the drops to be processed as a column %	 		vector labeled droplist.  Save droplist in %			droplist.mat in this folder.%		2. Set up cruise subfolder under MMP on large disk %		 	accessible from this program. Processed data goes %			there.%		3. Create timeplace.mat in cruise folder.  Read%			write_droptime1_mmp.m for format.%		4. Edit MMP:mmpdatabase to include drops being processed%		5. Edit MATLAB:mmp:mmpfolders to define source of raw data%			and destination of processed data%		6. Execute set_mmp_paths so needed scripts can be found%		7. Check and edit adjustable parameters below.%          a. If low epsilon's are expected, set eps_step so lowest%             wavenumber is 0.5 cpm or less%%	Files written are:%		1. MMP:<cruise>:timeplace.mat is updated with year & yday of drop%		2. MMP:<cruise>:thetasd:thetasd<drop>.mat%		3. MMP:<cruise>:eps:eps<drop>.mat%		4. MMP:<cruise>:chi:chi<drop>.mat%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%		more=1;while more==1	clear	close all	mmpfolders; 	% brings in path names of key directories	% Constants	global G	G=9.80655;    MAG_DECLINATION=0; % for nowhere	% adjustable parameters	start_scan=2;     	   % first scan to keep (scan 1 is bad for SeaBird data)	cond_shift=1;     	   % no of scans to shift csbe forward & remove from end of 						   % other ch	eps_step=512; 	  	   % number of samples per epsilon & estimate.	tcp_fc=3;			   % cutoff freq for low-pass filter applied to temp,cond,pr	chi_step=eps_step;	   % number of samples per chi estimate	cond='normal'; 	       % 'normal' for normal data in salt water, 	                       % 'fresh' for fresh water,  csbe=zeros(size(tsbe))						   % 'bad' , set csbe=[]    default_salinity=0;	   % For use in evaluating viscocity and diffusivity	                       % when salinity is bad.	displ_shear_spec='no'; % plot each af shear spec with universal overlay	save_eps_spec='yes';   % save all Pshear spec	displ_chi_spec='no';   % plot each th volt spec on screen	save_chi_spec='no';    % save all Ptgrad spec	%	% parameters fixed by data structure	FS_hf=400; 		  % sample rate of high-frequency channels	FS_lf=25;		  % sample rate of low-frequency channels	hfperscan=16; 	  % number of samples per scan in high-freq channels	tlpoly_degree=2;  % Degree of polynomial fitted to tl	%	% secondary parameters	dt_hf=1/FS_hf; 	  % sample period of high-frequency channels	scans_per_eps=fix(eps_step/hfperscan); % # scans per eps estimate	df=FS_hf/eps_step; % elementary frequency bandwidth	f=(df:df:df*eps_step/2)'; % frequency vector for spectra	%	global G	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 	Get number of drop to process and delete that number from%	droplist in droplist.mat	[drop,more]=getdrop_mmp;	msg=['drop=mmp' int2str(drop)]; disp(msg)	drop_flag=1; 			% continue processing while drop_flag==1	get_dropinfo1_mmp 		% gets & keeps mmpid, cruise, scanid, voffsetid for drop	                  		%   then loads & keeps offset_ch where ch is v1,v2, etc.		write_droptime2_mmp		% Reads year and yday from raw hdr and updates mmplog		calc_prscan2_mmp	calc_thetasd2_mmp		calc_kvh1_mmp		calc_accel1_mmp			% Reads accelerometers	calc_altimeter1_mmp		calc_vacm1_mmp			% Converts acoustic current meter data, channels vac1 & vac2,							% to m/s, but does not correct for vehicle orientation								calc_obs1_mmp			% If obs is installed in one of the 400 Hz channels,							% the data are low-passed, converted to FTUs, and							% subsampled to one per scan.	setup_epschi2_mmp	calc_eps2_mmp	calc_tl2_mmp	calc_chi2_mmp		mainplot1_mmp%	print%	pause(30)		motionplot1_mmp%	print%	pause(30)end %%%%%%%%%%% end of droplist while loop %%%%%%%%%%%%%